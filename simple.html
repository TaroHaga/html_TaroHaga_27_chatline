<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Chatã‚¢ãƒ—ãƒª</title>
<link rel="stylesheet" href="css/sample.css">
</head>
<body>
<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
<div>
    åå‰:  <input type="text" id="uname">
</div>
<div>
    <textarea name="" id="text" cols="30" rows="10"></textarea>
    <button id="send">é€ä¿¡</button>

</div>
<div class="sb-box">
    <div class="icon-img icon-img-left">
        <img src="imgs/9001_woody.jpg">
    </div><!-- /.icon-img icon-img-left -->
    <div class="icon-name icon-name-left"></div>
    <div class="sb-side sb-side-left">
        <div class="sb-txt sb-txt-left">
            <div id="output" class="output"></div>
        </div><!-- /.sb-txt sb-txt-left -->
    </div><!-- /.sb-side sb-side-left -->
</div><!-- /.sb-box -->
<!-- å¹ãå‡ºã—ï¼ˆå·¦ï¼‰ã®çµ‚ã‚ã‚Š -->







</div>
<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    import { getDatabase, ref, push, set, onChildAdded, remove, onChildRemoved }
        from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.8.1/firebase-database.min.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "",
      authDomain: "fir-kadai-3969b.firebaseapp.com",
      projectId: "fir-kadai-3969b",
      storageBucket: "fir-kadai-3969b.appspot.com",
      messagingSenderId: "367524432289",
      appId: "1:367524432289:web:639ffebc51c60e876fa3e0"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    
    const db = getDatabase(app);
    const dbRef = ref(db,'chat');

    let d=0
    const img= ["9001_woody.jpg","9002_bo-peep.jpg","9003_buzz-lightyear.jpg"];
    $(".imgs").on("click",function(){d=$(this).attr(date-img);
    });

//MSGé€ä¿¡
$('#send').on('click',function(){
    const msg={
        uname:$('#uname').val(),
        text:$('#text').val(),
        icon:d
    }
const newPostRef = push(dbRef);
set(newPostRef,msg);
    // const uname = $('#uname').val();
    // const text =$('#text').val();
});

//ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
onChildAdded(dbRef,function(date){
const msg = date.val();
const key = date.key;
const h = `<p id="${key}" class="message">${msg.uname}: ${msg.text}
    <button class="clear">ğŸ—‘</button>
    </p>`;
$('#output').append(h);
});

//ãƒ†ã‚­ã‚¹ãƒˆã§Enterã§é€ä¿¡
$('#text').on('keydown',function(e){
    if(e.keyCode === 13){
    const msg={
        uname:$('#uname').val(),
        text:$('#text').val(),
    }
const newPostRef = push(dbRef);
set(newPostRef,msg);
    }
});

//ãƒ†ã‚­ã‚¹ãƒˆå‰Šé™¤
$('#clear').on('click','.message', function(){
    const thisKey = $(this).attr("id");
        const dltKey = "chat/"+thisKey;
        remove(ref(db, dltKey));
  alert('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');
});

onChildRemoved(dbRef, function(data){
        const key = '#'+data.key;
        $(key).remove();
    });
$("#output").on("click",".message", function(){
    const dlt = $(this).attr('id');
    remove(ref(db, "chat/" + dlt));
});

  </script>












</body>
</html>
































